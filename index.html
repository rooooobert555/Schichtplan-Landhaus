<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Landhaus Fillert - Schichtplan</title>
    <style>
        /* --- SAUBERES UND RESPONSIVES DESIGN --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: #f0f2f5;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* --- AUTH CONTAINER --- */
        .auth-container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            text-align: center;
            width: 100%;
            max-width: 400px;
        }
        .auth-container h2 {
            margin-bottom: 25px;
            color: #34495e;
        }
        .auth-container .form-group {
            text-align: left;
            margin-bottom: 15px;
        }
        .auth-container input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        .auth-container .btn {
            width: 100%;
            margin-top: 10px;
        }
        .auth-container a {
            color: #667eea;
            cursor: pointer;
            font-size: 14px;
            display: block;
            margin-top: 20px;
            text-decoration: none;
        }
        .auth-container a:hover {
            text-decoration: underline;
        }

        /* --- HAUPT-APP CONTAINER --- */
        #appContainer {
            display: none;
            width: 100%;
            max-width: 1400px;
        }
        .container {
            background: #ffffff;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin-bottom: 10px;
        }
        #userInfo {
            color: #ecf0f1;
            margin-top: 15px;
        }
        #userInfo button {
            background: #e74c3c;
            border: none;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            cursor: pointer;
            margin-left: 10px;
            font-size: 12px;
        }
        .week-navigation {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
        }
        .week-nav-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
        }
        .current-week {
            font-size: 1.2em;
            font-weight: bold;
        }

        /* --- VERWALTUNGSBEREICH --- */
        .controls {
            padding: 25px;
            background: #f8f9fa;
        }
        .control-section {
            background: #ffffff;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            margin-bottom: 20px;
        }
        .control-section h4 {
            margin: 0 0 15px 0;
            color: #34495e;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 10px;
        }
        .input-group {
            display: flex;
            gap: 10px;
        }
        .input-group input {
             flex-grow: 1;
             padding: 10px; 
             border: 1px solid #ddd;
             border-radius: 8px;
        }
        .tag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }
        .tag {
            background: #34495e;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .remove-tag {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            line-height: 18px;
        }
        
        /* --- WOCHENPLAN GRID --- */
        .schedule-container {
            padding: 25px;
            overflow-x: auto;
        }
        .schedule-grid {
            display: grid;
            grid-template-columns: 180px repeat(7, 1fr);
            gap: 8px;
            min-width: 1100px;
        }
        .grid-header {
            font-weight: bold;
            padding: 15px 10px;
            text-align: center;
            border-radius: 10px;
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .day-header { background: #667eea; }
        .shift-type-header { background: #34495e; }
        .shift-cell {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 10px;
            min-height: 100px;
            display: flex;
            flex-direction: column;
        }
        .shift-cell-content { flex-grow: 1; }
        .shift-entry {
            background: #1abc9c;
            color: white;
            padding: 8px 10px;
            border-radius: 6px;
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }
        .shift-note { font-size: 12px; font-style: italic; opacity: 0.9; margin-top: 4px; }
        .remove-shift { background: rgba(255,255,255,0.2); width: 20px; height: 20px; border-radius: 50%; border:none; color:white; cursor:pointer;}
        .add-shift-btn {
            width: 100%;
            background: transparent;
            color: #667eea;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            border: 1px dashed #667eea;
            margin-top: auto;
            transition: all 0.2s;
        }
        .add-shift-btn:hover { background: rgba(102, 126, 234, 0.1); }
        
        /* --- MODAL --- */
        .modal { display: none; /* ... rest unverändert ... */ }
        .modal-content { /* ... rest unverändert ... */ }
        .form-buttons { display: flex; gap: 10px; justify-content: flex-end; }
        
    </style>
</head>
<body>

    <div id="authContainer" class="auth-container">
        </div>
    
    <div id="appContainer">
        <div class="container">
            <div class="header">
                <h1>Landhaus Fillert Schichtplan</h1>
                <div id="userInfo"></div>
                <div class="week-navigation">
                    <button class="week-nav-btn" onclick="changeWeek(-1)">←</button>
                    <div class="current-week" id="currentWeek"></div>
                    <button class="week-nav-btn" onclick="changeWeek(1)">→</button>
                </div>
            </div>
            <div class="controls">
                <div class="control-section" id="adminControls">
                    <h4>Verwaltung</h4>
                    <div class="form-group">
                        <label>Mitarbeiter:</label>
                        <div class="input-group">
                            <input type="text" id="newEmployeeName" placeholder="Neuer Mitarbeiter...">
                            <button class="btn btn-primary" onclick="addEmployee()">+</button>
                        </div>
                        <div class="tag-list" id="employeeList"></div>
                    </div>
                    <div class="form-group">
                        <label>Schicht-Typen:</label>
                        <div class="input-group">
                            <input type="text" id="newShiftTypeName" placeholder="z.B. Küche (11-22 Uhr)...">
                            <button class="btn btn-primary" onclick="addShiftType()">+</button>
                        </div>
                        <div class="tag-list" id="shiftTypeList"></div>
                    </div>
                </div>
            </div>
            <div class="schedule-container">
                <div class="schedule-grid" id="scheduleGrid"></div>
            </div>
        </div>
    </div>
    <div class="modal" id="shiftModal">
        </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <script>
        // ==== DEINE FIREBASE KONFIG HIER EINTRAGEN ====
        const firebaseConfig = {
            apiKey: "AIzaSyDtCPZ5YTOQxNrjAwCtIoSVh1-4nlPWHCs",
            authDomain: "schichtplan-e6649.firebaseapp.com",
            databaseURL: "https://schichtplan-e6649-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "schichtplan-e6649",
            storageBucket: "schichtplan-e6649.firebasestorage.app",
            messagingSenderId: "997401888806",
            appId: "1:997401888806:web:b80e084f322b27dc4ffee7"
        };
        // ==============================================

        // Der gesamte JavaScript-Code bleibt funktional unverändert.
        // Er wird hier zur Übersichtlichkeit nicht nochmal komplett eingefügt,
        // da du ja sagtest, dass die Funktionen alle passen.
        // Füge hier den letzten funktionierenden JavaScript-Block ein.

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();
        const dbRef = database.ref('/');
        const scheduleRef = dbRef.child('scheduleFinal');

        let employees = [], shifts = {}, shiftTypes = [], currentWeekOffset = 0, currentModalSlot = null, isAdmin = false;
        const dayNames = ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So']; // Abgekürzt für kleinere Bildschirme
        
        const authContainer = document.getElementById('authContainer');
        const appContainer = document.getElementById('appContainer');
        const userInfo = document.getElementById('userInfo');
        const loginView = document.getElementById('loginView');
        const registerView = document.getElementById('registerView');
        const modal = document.getElementById('shiftModal');

        auth.onAuthStateChanged(user => {
            if (user) {
                checkAdminStatus(user.uid);
            } else {
                isAdmin = false;
                authContainer.style.display = 'block';
                appContainer.style.display = 'none';
            }
        });

        function checkAdminStatus(uid) {
            dbRef.child('admins').child(uid).once('value', snapshot => {
                isAdmin = snapshot.exists();
                authContainer.style.display = 'none';
                appContainer.style.display = 'block';
                userInfo.innerHTML = `${auth.currentUser.email} <button onclick="logout()">Logout</button>`;
                initializeDataListeners();
            });
        }

        function toggleView() {
            loginView.style.display = loginView.style.display === 'none' ? 'block' : 'none';
            registerView.style.display = registerView.style.display === 'none' ? 'block' : 'none';
        }

        function register() {
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            auth.createUserWithEmailAndPassword(email, password).catch(error => alert(error.message));
        }

        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            auth.signInWithEmailAndPassword(email, password).catch(error => alert(error.message));
        }

        function logout() { auth.signOut(); }

        function initializeDataListeners() {
            scheduleRef.on('value', snapshot => {
                const data = snapshot.val() || {};
                employees = data.employees || [];
                shifts = data.shifts || {};
                shiftTypes = data.shiftTypes || [];
                renderAll();
            });
        }
        
        function renderAll() {
            updateWeekDisplay();
            updateControlPanel();
            renderSchedule();
        }

        function updateControlPanel() {
            document.getElementById('adminControls').style.display = isAdmin ? 'block' : 'none';
            if(isAdmin){
                updateEmployeeList();
                updateShiftTypeList();
            }
        }
        
        function getWeekDates(offset = 0) { const today = new Date(); const dayOfWeek = today.getDay() === 0 ? 7 : today.getDay(); const monday = new Date(today); monday.setDate(today.getDate() - dayOfWeek + 1 + (offset * 7)); const dates = []; for (let i = 0; i < 7; i++) { const date = new Date(monday); date.setDate(monday.getDate() + i); dates.push(date); } return dates; }
        function getWeekNumber(date) { const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate())); const dayNum = d.getUTCDay() || 7; d.setUTCDate(d.getUTCDate() + 4 - dayNum); const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1)); return Math.ceil((((d - yearStart) / 86400000) + 1)/7); }
        function formatDate(date) { return date.toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit' }); }
        function getShiftKey(date, shiftType) { const safeShiftType = shiftType.replace(/[.$#[\]/]/g, '_'); return `${date.toISOString().split('T')[0]}__${safeShiftType}`; }
        
        function changeWeek(direction) { currentWeekOffset += direction; renderAll(); }
        function updateWeekDisplay() { const weekDates = getWeekDates(currentWeekOffset); const startDate = formatDate(weekDates[0]); const endDate = formatDate(weekDates[6]); const weekNumber = getWeekNumber(weekDates[0]); document.getElementById('currentWeek').textContent = `KW ${weekNumber} (${startDate} - ${endDate})`; }
        
        function updateEmployeeList() { const container = document.getElementById('employeeList'); container.innerHTML = employees.map(emp => `<div class="tag">${emp}<button class="remove-tag" onclick="removeEmployee('${emp}')">×</button></div>`).join(''); }
        function updateShiftTypeList() { const container = document.getElementById('shiftTypeList'); container.innerHTML = shiftTypes.map(st => `<div class="tag">${st}<button class="remove-tag" onclick="removeShiftType('${st}')">×</button></div>`).join(''); }
        
        function addEmployee() { const nameInput = document.getElementById('newEmployeeName'); const name = nameInput.value.trim(); if (name && !employees.includes(name)) { scheduleRef.child('employees').set([...employees, name]); nameInput.value = ''; } }
        function removeEmployee(nameToRemove) { if (confirm(`Mitarbeiter "${nameToRemove}" entfernen?`)) { scheduleRef.child('employees').set(employees.filter(emp => emp !== nameToRemove)); } }
        function addShiftType() { const nameInput = document.getElementById('newShiftTypeName'); const name = nameInput.value.trim(); if (name && !shiftTypes.includes(name)) { scheduleRef.child('shiftTypes').set([...shiftTypes, name]); nameInput.value = ''; } }
        function removeShiftType(typeToRemove) { if (confirm(`Schicht-Typ "${typeToRemove}" entfernen?`)) { scheduleRef.child('shiftTypes').set(shiftTypes.filter(st => st !== typeToRemove)); } }
        
        function renderSchedule() { const grid = document.getElementById('scheduleGrid'); const weekDates = getWeekDates(currentWeekOffset); let html = '<div></div>'; weekDates.forEach(date => { html += `<div class="grid-header day-header">${dayNames[date.getDay() === 0 ? 6 : date.getDay() - 1]}<div class="day-date">${formatDate(date)}</div></div>`; }); shiftTypes.forEach(shiftType => { html += `<div class="grid-header shift-type-header">${shiftType}</div>`; weekDates.forEach(date => { const shiftKey = getShiftKey(date, shiftType); const assignedShifts = shifts[shiftKey] || []; let shiftsHtml = ''; assignedShifts.forEach(shift => { shiftsHtml += `<div class="shift-entry"><div class="shift-details"><div class="employee-name">${shift.employee}</div>${shift.note ? `<div class="shift-note">${shift.note}</div>` : ''}</div>${isAdmin ? `<button class="remove-shift" onclick="removeShift('${date.toISOString()}', '${shiftType}', '${shift.employee}')">×</button>` : ''}</div>`; }); const addBtnHtml = isAdmin ? `<button class="add-shift-btn" onclick="openModal('${date.toISOString()}', '${shiftType}')">+</button>` : ''; html += `<div class="shift-cell"><div class="shift-cell-content">${shiftsHtml}</div>${addBtnHtml}</div>`; }); }); grid.innerHTML = html; }
        
        function openModal(date, shiftType) { currentModalSlot = { date, shiftType }; modal.style.display = 'flex'; updateModalEmployeeSelect(); }
        function closeModal() { modal.style.display = 'none'; document.getElementById('modalNote').value = ''; currentModalSlot = null; }
        
        function updateModalEmployeeSelect() { const select = document.getElementById('modalEmployee'); if (employees.length > 0) { select.innerHTML = employees.map(emp => `<option value="${emp}">${emp}</option>`).join(''); } else { select.innerHTML = '<option disabled>Bitte zuerst Mitarbeiter anlegen</option>'; } }
        
        function saveShift() { if (!currentModalSlot) return; const employee = document.getElementById('modalEmployee').value; const note = document.getElementById('modalNote').value.trim(); if (!employee) { return alert('Bitte einen Mitarbeiter auswählen!'); } const shiftKey = getShiftKey(new Date(currentModalSlot.date), currentModalSlot.shiftType); const newShift = { employee, note }; const currentShifts = shifts[shiftKey] || []; if (currentShifts.some(s => s.employee === employee)) { return alert(`${employee} ist bereits eingeteilt.`); } scheduleRef.child('shifts').child(shiftKey).set([...currentShifts, newShift]); closeModal(); }
        function removeShift(dateStr, shiftType, employeeToRemove) { const date = new Date(dateStr); const shiftKey = getShiftKey(date, shiftType); if (shifts[shiftKey]) { const updatedShifts = shifts[shiftKey].filter(s => s.employee !== employeeToRemove); if (updatedShifts.length > 0) { scheduleRef.child('shifts').child(shiftKey).set(updatedShifts); } else { scheduleRef.child('shifts').child(shiftKey).remove(); } } }
    </script>
</body>
</html>
