

<script>
    // ============== DEINE FIREBASE CONFIG HIER EINFÜGEN ==============
    const firebaseConfig = {
            apiKey: "AIzaSyDtCPZ5YTOQxNrjAwCtIoSVh1-4nlPWHCs",
            authDomain: "schichtplan-e6649.firebaseapp.com",
            databaseURL: "https://schichtplan-e6649-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "schichtplan-e6649",
            storageBucket: "schichtplan-e6649.firebasestorage.app",
            messagingSenderId: "997401888806",
            appId: "1:997401888806:web:b80e084f322b27dc4ffee7"
    };
    // ===============================================================

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const auth = firebase.auth();
    const dbRef = database.ref('/'); // Wir brauchen Zugriff auf die Root-Ebene für die Admin-Prüfung
    const scheduleRef = dbRef.child('scheduleCustom');

    // --- GLOBALE VARIABLEN ---
    let employees = [];
    let shifts = {};
    let shiftTypes = [];
    let currentWeekOffset = 0;
    let currentModalSlot = null;
    let isAdmin = false; // NEU: Um den Admin-Status zu speichern

    const dayNames = ['Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag', 'Sonntag'];
    
    // --- AUTH-LOGIK ---
    const authContainer = document.getElementById('authContainer');
    const appContainer = document.getElementById('appContainer');
    const userInfo = document.getElementById('userInfo');

    auth.onAuthStateChanged(user => {
        if (user) {
            checkAdminStatus(user.uid); // Prüfe, ob der User ein Admin ist
            authContainer.style.display = 'none';
            appContainer.style.display = 'block';
            userInfo.innerHTML = `${user.email} <button onclick="logout()">Logout</button>`;
        } else {
            isAdmin = false; // Beim Logout zurücksetzen
            authContainer.style.display = 'block';
            appContainer.style.display = 'none';
            userInfo.innerHTML = '';
        }
    });
    
    // NEUE FUNKTION: Prüft, ob die UID des Users in der Admin-Liste steht
    function checkAdminStatus(uid) {
        dbRef.child('admins').child(uid).once('value', snapshot => {
            isAdmin = snapshot.exists(); // Setzt `isAdmin` auf true, wenn der Eintrag existiert
            initializeDataListeners(); // Daten erst laden, NACHDEM wir den Admin-Status kennen
        });
    }

    function toggleView() { /* ... unverändert ... */ }
    function register() { /* ... unverändert ... */ }
    function login() { /* ... unverändert ... */ }
    function logout() { auth.signOut(); }

    // --- DATEN-LOGIK ---
    function initializeDataListeners() {
        database.ref('.info/connected').on('value', (snap) => { /* ... unverändert ... */ });

        scheduleRef.on('value', (snapshot) => {
            const data = snapshot.val() || {};
            employees = data.employees || [];
            shifts = data.shifts || {};
            shiftTypes = data.shiftTypes || [];
            renderAll();
        });
    }
    
    function renderAll() {
        // Übergibt den Admin-Status an die Render-Funktionen
        updateWeekDisplay();
        updateEmployeeList(isAdmin);
        updateShiftTypeList(isAdmin);
        renderSchedule(isAdmin);
    }
    
    // --- ANGEPASSTE RENDER-FUNKTIONEN ---
    // Fast alle Funktionen, die etwas anzeigen, prüfen jetzt, ob der User Admin ist.
    
    function updateEmployeeList(isAdmin) {
        const container = document.getElementById('employeeList');
        // Zeige den "Entfernen"-Button nur für Admins
        container.innerHTML = employees.map(emp => `
            <div class="tag">${emp}
                ${isAdmin ? `<button class="remove-tag" onclick="removeEmployee('${emp}')">×</button>` : ''}
            </div>`).join('');
    }

    function updateShiftTypeList(isAdmin) {
        const container = document.getElementById('shiftTypeList');
        // Zeige den "Entfernen"-Button nur für Admins
        container.innerHTML = shiftTypes.map(st => `
            <div class="tag">${st}
                ${isAdmin ? `<button class="remove-tag" onclick="removeShiftType('${st}')">×</button>` : ''}
            </div>`).join('');
    }

    function renderSchedule(isAdmin) {
        const grid = document.getElementById('scheduleGrid');
        const weekDates = getWeekDates(currentWeekOffset);
        let html = '<div class="grid-header shift-type-header">Schicht</div>'; 
        weekDates.forEach(date => { html += `<div class="grid-header day-header">${dayNames[date.getDay() === 0 ? 6 : date.getDay() - 1]}<br><div class="day-date">${formatDate(date)}</div></div>`; });
        
        shiftTypes.forEach(shiftType => {
            html += `<div class="grid-header shift-type-header">${shiftType}</div>`;
            weekDates.forEach(date => {
                const shiftKey = getShiftKey(date, shiftType);
                const assignedShifts = shifts[shiftKey] || [];
                let shiftsHtml = '';
                assignedShifts.forEach(shift => {
                    shiftsHtml += `
                        <div class="shift-entry">
                            <div class="shift-details">
                                <div class="employee-name">${shift.employee}</div>
                                ${shift.note ? `<div class="shift-note">${shift.note}</div>` : ''}
                            </div>
                            ${isAdmin ? `<button class="remove-shift" onclick="removeShift('${date.toISOString()}', '${shiftType}', '${shift.employee}')">×</button>` : ''}
                        </div>
                    `;
                });
                // Zeige den "Zuweisen"-Button nur für Admins
                const addBtnHtml = isAdmin ? `<button class="add-shift-btn" onclick="openModal('${date.toISOString()}', '${shiftType}')">+ Zuweisen</button>` : '';
                html += `<div class="shift-cell"><div class="shift-cell-content">${shiftsHtml}</div>${addBtnHtml}</div>`;
            });
        });
        grid.innerHTML = html;
        
        // Blende die gesamten Verwaltungs-Controls für Nicht-Admins aus
        document.querySelector('.controls').style.display = isAdmin ? 'block' : 'none';
    }

    // --- Alle anderen Funktionen (addEmployee, saveShift etc.) bleiben gleich, da die neuen Regeln sie in der Datenbank blockieren würden ---
    // (Hier folgt der Rest deiner unveränderten JavaScript-Funktionen)

</script>
