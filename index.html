<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Schichtplan - Online</title>
    <style>
        /* Der komplette CSS-Code bleibt hier unver√§ndert. */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Arial', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 20px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1); overflow: hidden; }
        .header { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; padding: 30px; text-align: center; position: relative; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); }
        .connection-status { position: absolute; top: 20px; right: 20px; display: flex; align-items: center; gap: 8px; background: rgba(255, 255, 255, 0.1); padding: 8px 15px; border-radius: 20px; font-size: 14px; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; background: #4CAF50; animation: pulse 2s infinite; }
        .status-dot.offline { background: #f44336; animation: none; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .week-navigation { display: flex; justify-content: center; align-items: center; gap: 20px; margin-top: 20px; }
        .week-nav-btn { background: rgba(255, 255, 255, 0.2); border: 2px solid rgba(255, 255, 255, 0.3); color: white; padding: 12px 20px; border-radius: 10px; cursor: pointer; transition: all 0.3s ease; font-size: 16px; }
        .week-nav-btn:hover { background: rgba(255, 255, 255, 0.3); transform: translateY(-2px); }
        .current-week { font-size: 1.2em; font-weight: bold; min-width: 200px; }
        .controls { padding: 20px 30px; background: #f8f9fa; border-bottom: 1px solid #e9ecef; }
        .employee-management { display: flex; gap: 15px; align-items: center; flex-wrap: wrap; }
        .input-group { display: flex; gap: 10px; align-items: center; }
        input[type="text"] { padding: 12px 15px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px; transition: border-color 0.3s ease; }
        input[type="text"]:focus { outline: none; border-color: #667eea; }
        .btn { padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: bold; transition: all 0.3s ease; }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
        .btn-danger { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); color: white; }
        .btn-danger:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4); }
        .schedule-container { padding: 30px; }
        .schedule-grid { display: grid; grid-template-columns: 120px repeat(7, 1fr); gap: 15px; margin-bottom: 30px; }
        .time-slot { background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); color: white; padding: 15px 10px; text-align: center; border-radius: 10px; font-weight: bold; display: flex; align-items: center; justify-content: center; min-height: 80px; }
        .day-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; text-align: center; border-radius: 10px; font-weight: bold; }
        .day-date { font-size: 0.9em; opacity: 0.9; margin-top: 5px; }
        .shift-cell { background: white; border: 2px solid #e9ecef; border-radius: 10px; padding: 15px; min-height: 120px; position: relative; transition: all 0.3s ease; }
        .shift-cell:hover { border-color: #667eea; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }
        .shift-entry { background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%); color: white; padding: 8px 12px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
        .shift-entry .employee-name { font-weight: bold; flex-grow: 1; }
        .shift-entry .shift-time { font-size: 0.9em; opacity: 0.9; margin-left: 10px; }
        .remove-shift { background: rgba(255, 255, 255, 0.2); border: none; color: white; width: 20px; height: 20px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; margin-left: 8px; transition: background 0.3s ease; }
        .remove-shift:hover { background: rgba(255, 255, 255, 0.3); }
        .add-shift-btn { width: 100%; background: rgba(102, 126, 234, 0.1); border: 2px dashed #667eea; color: #667eea; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease; }
        .add-shift-btn:hover { background: rgba(102, 126, 234, 0.2); transform: scale(1.02); }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(5px); z-index: 1000; }
        .modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3); min-width: 400px; }
        .modal h3 { margin-bottom: 20px; color: #2c3e50; text-align: center; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #2c3e50; }
        select, input[type="time"] { width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px; }
        select:focus, input[type="time"]:focus { outline: none; border-color: #667eea; }
        .form-buttons { display: flex; gap: 15px; justify-content: center; margin-top: 25px; }
        .statistics { background: #f8f9fa; padding: 20px; border-radius: 15px; margin-top: 30px; }
        .statistics h3 { color: #2c3e50; margin-bottom: 15px; text-align: center; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .stat-card { background: white; padding: 20px; border-radius: 10px; text-align: center; border-left: 4px solid #667eea; }
        .stat-number { font-size: 2em; font-weight: bold; color: #667eea; }
        .stat-label { color: #666; margin-top: 5px; }
        .employee-list { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px; }
        .employee-tag { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px 15px; border-radius: 20px; font-size: 14px; display: flex; align-items: center; gap: 8px; }
        .employee-tag .remove-employee { background: rgba(255, 255, 255, 0.2); border: none; color: white; width: 18px; height: 18px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .notification { position: fixed; top: 20px; right: 20px; background: #4CAF50; color: white; padding: 15px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); transform: translateX(400px); transition: transform 0.3s ease; z-index: 1001; max-width: 300px; }
        .notification.show { transform: translateX(0); }
        .notification.error { background: #f44336; }
        @media (max-width: 768px) {
            .container { padding: 0; }
            .schedule-grid { grid-template-columns: 80px repeat(7, 1fr); gap: 8px; }
            .shift-cell { padding: 8px; min-height: 100px; }
            .time-slot { padding: 8px 5px; font-size: 12px; min-height: 60px; }
            .day-header { padding: 10px 5px; font-size: 14px; }
            .header { padding: 20px; }
            .header h1 { font-size: 1.8em; }
            .employee-management { flex-direction: column; align-items: stretch; }
            .connection-status { position: static; margin-top: 15px; justify-content: center; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="connection-status">
                <div class="status-dot offline" id="statusDot"></div>
                <span id="connectionStatus">Verbinde...</span>
            </div>
            <h1>üçΩÔ∏è Restaurant Schichtplan</h1>
            <div class="week-navigation">
                <button class="week-nav-btn" onclick="changeWeek(-1)">‚Üê Vorherige Woche</button>
                <div class="current-week" id="currentWeek"></div>
                <button class="week-nav-btn" onclick="changeWeek(1)">N√§chste Woche ‚Üí</button>
            </div>
        </div>
        <div class="controls">
            <div class="employee-management">
                <div class="input-group">
                    <input type="text" id="newEmployeeName" placeholder="Neuer Mitarbeiter..." maxlength="30">
                    <button class="btn btn-primary" onclick="addEmployee()">Mitarbeiter hinzuf√ºgen</button>
                </div>
                <button class="btn btn-danger" onclick="clearAllShifts()">Alle Schichten der Woche l√∂schen</button>
            </div>
            <div class="employee-list" id="employeeList"></div>
        </div>
        <div class="schedule-container">
            <div class="schedule-grid" id="scheduleGrid"></div>
            <div class="statistics">
                <h3>üìä Wochenstatistiken</h3>
                <div class="stats-grid" id="statisticsGrid"></div>
            </div>
        </div>
    </div>
    <div class="modal" id="shiftModal">
        <div class="modal-content">
            <h3>Neue Schicht hinzuf√ºgen</h3>
            <div class="form-group">
                <label for="modalEmployee">Mitarbeiter:</label>
                <select id="modalEmployee"></select>
            </div>
            <div class="form-group">
                <label for="modalStartTime">Startzeit:</label>
                <input type="time" id="modalStartTime" value="09:00">
            </div>
            <div class="form-group">
                <label for="modalEndTime">Endzeit:</label>
                <input type="time" id="modalEndTime" value="17:00">
            </div>
            <div class="form-buttons">
                <button class="btn btn-primary" onclick="saveShift()">Schicht speichern</button>
                <button class="btn" onclick="closeModal()" style="background: #6c757d; color: white;">Abbrechen</button>
            </div>
        </div>
    </div>
    <div class="notification" id="notification"></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // F√úGE HIER DEINE PERS√ñNLICHE FIREBASE KONFIGURATION EIN
        // Import the functions you need from the SDKs you need
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyDtCPZ5YTOQxNrjAwCtIoSVh1-4nlPWHCs",
  authDomain: "schichtplan-e6649.firebaseapp.com",
  databaseURL: "https://schichtplan-e6649-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "schichtplan-e6649",
  storageBucket: "schichtplan-e6649.firebasestorage.app",
  messagingSenderId: "997401888806",
  appId: "1:997401888806:web:b80e084f322b27dc4ffee7",
  measurementId: "G-WTXQB37FFW"
};

// Initialize Firebase
    let employees = [];
    let shifts = {};
    let currentWeekOffset = 0;
    let currentModalSlot = null;
    
    const timeSlots = ['06:00 - 14:00', '14:00 - 22:00', '22:00 - 06:00'];
    const dayNames = ['Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag', 'Sonntag'];

    // Firebase initialisieren (NUR DIESE EINE ZEILE IST KORREKT)
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const dbRef = database.ref('/schedule');

    // Verbindung zu Firebase √ºberwachen
    database.ref('.info/connected').on('value', (snap) => {
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('connectionStatus');
        if (snap.val() === true) {
            statusDot.className = 'status-dot';
            statusText.textContent = 'Online';
        } else {
            statusDot.className = 'status-dot offline';
            statusText.textContent = 'Offline';
        }
    });

    // Auf Daten√§nderungen aus Firebase lauschen
    dbRef.on('value', (snapshot) => {
        const data = snapshot.val();
        if (data && data.employees) {
            employees = data.employees;
            shifts = data.shifts || {};
        } else {
            const initialData = {
                employees: ["Max Mustermann", "Anna Schmidt"],
                shifts: {}
            };
            dbRef.set(initialData);
        }
        renderAll();
    });

    function renderAll() {
        updateWeekDisplay();
        updateEmployeeList();
        updateModalEmployeeSelect();
        renderSchedule();
        updateStatistics();
    }

    function getWeekDates(weekOffset = 0) { const today = new Date(); const dayOfWeek = today.getDay() === 0 ? 7 : today.getDay(); const monday = new Date(today); monday.setDate(today.getDate() - dayOfWeek + 1 + (weekOffset * 7)); const dates = []; for (let i = 0; i < 7; i++) { const date = new Date(monday); date.setDate(monday.getDate() + i); dates.push(date); } return dates; }
    function getWeekNumber(date) { const firstDayOfYear = new Date(date.getFullYear(), 0, 1); const pastDaysOfYear = (date - firstDayOfYear) / 86400000; return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7); }
    function formatDate(date) { return date.toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit' }); }
    function getShiftKey(date, timeSlot) { return `${date.toISOString().split('T')[0]}__${timeSlot.replace(/ /g, '').replace(/:/g, '')}`; }

    function addEmployee() { const nameInput = document.getElementById('newEmployeeName'); const name = nameInput.value.trim(); if (name && !employees.includes(name)) { const newEmployees = [...employees, name]; database.ref('schedule/employees').set(newEmployees); nameInput.value = ''; } }
    function removeEmployee(nameToRemove) { if (confirm(`Mitarbeiter "${nameToRemove}" wirklich entfernen? Alle Schichten werden gel√∂scht.`)) { const newEmployees = employees.filter(emp => emp !== nameToRemove); const newShifts = { ...shifts }; Object.keys(newShifts).forEach(key => { newShifts[key] = newShifts[key].filter(shift => shift.employee !== nameToRemove); if (newShifts[key].length === 0) { delete newShifts[key]; } }); database.ref('schedule').update({ employees: newEmployees, shifts: newShifts }); } }
    function updateEmployeeList() { const container = document.getElementById('employeeList'); container.innerHTML = employees.map(emp => `<div class="employee-tag">${emp}<button class="remove-employee" onclick="removeEmployee('${emp}')">√ó</button></div>`).join(''); }
    function updateModalEmployeeSelect() { const select = document.getElementById('modalEmployee'); select.innerHTML = employees.map(emp => `<option value="${emp}">${emp}</option>`).join(''); }

    function openShiftModal(date, timeSlot) { currentModalSlot = { date, timeSlot }; document.getElementById('shiftModal').style.display = 'block'; updateModalEmployeeSelect(); }
    function closeModal() { document.getElementById('shiftModal').style.display = 'none'; currentModalSlot = null; }
    function saveShift() { if (!currentModalSlot) return; const employee = document.getElementById('modalEmployee').value; const startTime = document.getElementById('modalStartTime').value; const endTime = document.getElementById('modalEndTime').value; if (!employee || !startTime || !endTime) { return; } const shiftKey = getShiftKey(new Date(currentModalSlot.date), currentModalSlot.timeSlot); const newShift = { employee, startTime, endTime }; const currentShiftsInSlot = shifts[shiftKey] || []; const updatedShiftsInSlot = [...currentShiftsInSlot, newShift]; database.ref(`schedule/shifts/${shiftKey}`).set(updatedShiftsInSlot); closeModal(); }
    function removeShift(dateStr, timeSlot, index) { const date = new Date(dateStr); const shiftKey = getShiftKey(date, timeSlot); if (shifts[shiftKey] && shifts[shiftKey][index]) { const updatedShiftsInSlot = [...shifts[shiftKey]]; updatedShiftsInSlot.splice(index, 1); if (updatedShiftsInSlot.length > 0) { database.ref(`schedule/shifts/${shiftKey}`).set(updatedShiftsInSlot); } else { database.ref(`schedule/shifts/${shiftKey}`).remove(); } } }
    function clearAllShifts() { if (confirm('Wirklich alle Schichten dieser Woche l√∂schen?')) { const weekDates = getWeekDates(currentWeekOffset); const updates = {}; weekDates.forEach(date => { timeSlots.forEach(timeSlot => { const shiftKey = getShiftKey(date, timeSlot); if (shifts[shiftKey]) { updates[`/schedule/shifts/${shiftKey}`] = null; } }); }); database.ref().update(updates); } }

    function changeWeek(direction) { currentWeekOffset += direction; renderAll(); }
    function updateWeekDisplay() { const weekDates = getWeekDates(currentWeekOffset); const weekNumber = getWeekNumber(weekDates[0]); const startDate = formatDate(weekDates[0]); const endDate = formatDate(weekDates[6]); document.getElementById('currentWeek').textContent = `KW ${getWeekNumber(new Date())} (${startDate} - ${endDate})`; }
    function renderSchedule() { const container = document.getElementById('scheduleGrid'); const weekDates = getWeekDates(currentWeekOffset); let html = '<div class="time-slot">Uhrzeit</div>'; weekDates.forEach(date => { html += `<div class="day-header">${dayNames[date.getDay() === 0 ? 6 : date.getDay() - 1]}<div class="day-date">${formatDate(date)}</div></div>`; }); timeSlots.forEach(timeSlot => { html += `<div class="time-slot">${timeSlot}</div>`; weekDates.forEach(date => { const shiftKey = getShiftKey(date, timeSlot); const dayShifts = shifts[shiftKey] || []; html += `<div class="shift-cell" id="cell_${shiftKey}">${dayShifts.map((shift, index) => `<div class="shift-entry"><div><div class="employee-name">${shift.employee}</div><div class="shift-time">${shift.startTime} - ${shift.endTime}</div></div><button class="remove-shift" onclick="removeShift('${date.toISOString()}', '${timeSlot}', ${index})">√ó</button></div>`).join('')}<button class="add-shift-btn" onclick="openShiftModal('${date.toISOString()}', '${timeSlot}')">+ Schicht</button></div>`; }); }); container.innerHTML = html; }
    function updateStatistics() { const weekDates = getWeekDates(currentWeekOffset); const stats = { totalShifts: 0, totalHours: 0, employeeStats: {} }; employees.forEach(emp => { stats.employeeStats[emp] = { shifts: 0, hours: 0 }; }); weekDates.forEach(date => { timeSlots.forEach(timeSlot => { const shiftKey = getShiftKey(date, timeSlot); const dayShifts = shifts[shiftKey] || []; dayShifts.forEach(shift => { stats.totalShifts++; const start = new Date(`2000-01-01T${shift.startTime}`); const end = new Date(`2000-01-01T${shift.endTime}`); if (end < start) end.setDate(end.getDate() + 1); const hours = (end - start) / (1000 * 60 * 60); stats.totalHours += hours; if (stats.employeeStats[shift.employee]) { stats.employeeStats[shift.employee].shifts++; stats.employeeStats[shift.employee].hours += hours; } }); }); }); const container = document.getElementById('statisticsGrid'); const topEmployee = Object.keys(stats.employeeStats).reduce((a, b) => stats.employeeStats[a].hours > stats.employeeStats[b].hours ? a : b, employees[0] || 'Niemand'); container.innerHTML = `<div class="stat-card"><div class="stat-number">${stats.totalShifts}</div><div class="stat-label">Gesamte Schichten</div></div><div class="stat-card"><div class="stat-number">${Math.round(stats.totalHours)}h</div><div class="stat-label">Gesamte Stunden</div></div><div class="stat-card"><div class="stat-number">${employees.length}</div><div class="stat-label">Mitarbeiter</div></div><div class="stat-card"><div class="stat-number">${topEmployee}</div><div class="stat-label">Meiste Stunden</div></div>`; }
    
    document.addEventListener('DOMContentLoaded', renderAll);
    document.getElementById('newEmployeeName').addEventListener('keypress', (e) => e.key === 'Enter' && addEmployee());
    document.getElementById('shiftModal').addEventListener('click', (e) => e.target === document.getElementById('shiftModal') && closeModal());
</script>
